---
title: "Youtube Video"
author: Chuyue Xie
output: 
    html_notebook:
    fig_height: 6
    fig_width: 12
---

# Motivation
YouTube has become one of the most popular worldwide video sharing platform nowadays. It includes videos varying from music videos to makeup tutorials, from lifestyle vlogs to education videos... YouTube seem be be a hub of creativity and informations. To organize these videos, they are required to be put into cateogries when uploaded. Choosing the approriate category can be important in increasing views through exposing to the right audiences. This project focuses on discovering what are the differences among YouTube video categories. This can help users to better understand these categories and make better decisions when deciding on choosing categories.

# Data Source
For this project, the dataset used is found at Kaggle published by Mitchell J, a software developer at Backbeat Technologies. The version this project based on is version 115. The following is a weblink to the Kaggle page of the dataset: [Trending YouTube Video Statistics](https://www.kaggle.com/datasnaek/youtube-new). The main dataset used in this project are *USvideos.csv*. The supporting dataset is *US_category_id.json*, which serves as a dictionary that match category id to category names.

# Set Up

### Clean up environment and load packages
```{r message=FALSE, paged.print=FALSE}
# clean up the RStudio environment 
rm(list = ls())

# load all packages here: `mosaic`, `tidyverse`, `lubridate`, and all others used
library(mosaic)
library(tidyverse)
library(lubridate)
library(DataComputing)
library(ggplot2)
library(rjson)
library(rvest)
library(party)
library(ggrepel)
library(wordcloud)
```

### Data Intake
The codes below read in data tables from downloaded csv files (These files can be downloaded through kaggle too).
```{r message=FALSE, warning=FALSE}
### Load US videos data from USvideos.csv
US_data <- read_csv("USvideos.csv") #full data with 40949 rows
#US_sub_data <- # small data with 10k rows
  #US_data %>%
  #head(10000)
US_category_table <- fromJSON(file = "US_category_id.json") #table of category value for US
```

### Data Table Inspection
To start with, the main table with video information for US and its category names are inspected:
```{r}
### US videos dataset
US_data %>%
  glimpse() #the glimpse function will present the columns down the page and rows across

### US category datatable
print("US category datatable: ")
US_category_table %>%
  glimpse()
```
According to the output, there are 16 variables in total for US video datasets. They are video id, trending date (chr), title (chr), channel title (chr), category id (dbl), publish time (dttm), tags (chr), views (dbl), likes (dbl), dislikes (dbl), comment count (dbl), thumbnail link (chr), comments disabled (lgl), ratings disabled (lgl), and video error or removed (lgl), and description (chr). 

Moreover, for the category dataset, it they look a little messy. There are a 32 levels for US category datasets. Further cleaning of the data table will be conducted in later steps.

In order to decrease the dimension of the tables and prepare it for further analysis, the next step is to transform variable type and clean the data table.

### Data Preprocessing

In this project, the main focus will be place on variables including channel title, category iddescription for US data. Other variables will be revoved.

```{r}
### Select variables for the US dataset
US_data <-
  US_data %>%
  select(video_id, trending_date, title, channel_title, category_id, publish_time, views, likes, dislikes, description, comments_disabled, ratings_disabled, video_error_or_removed, comment_count) 
```

Notice that trending date and category id are not in the right form. Trending date should be a time variable, but is recognized as a character string. Moreover, category id should be a character string, but is recognized as a number. In the next step, variables trending date and category id are converted into the correct format.

```{r}
### Convert variables for the US video dataset
US_data <-
  US_data %>%
  mutate(trending_date = ydm(trending_date), category_id = as.character(category_id))
```

For the original dataset, the category id variable is named as numbers. In order to give it more meanings, it is transformed into real video category names for furhter analysis.

```{r}
#Step 1: Use the US category table fo create a table for category id&name conversion
id <- rep(c(0), 32) #ccreate a string with length 32 with values equal to 0
name <- rep(c(0), 32) #create a string with length 32 with values equal to 0

### Use US category table to define id and their corresponding movie category name
for (i in 1:32){
  id[i] = US_category_table$items[[i]]$id
  name[i] = US_category_table$items[[i]]$snippet$title
}

### Create a new table that contain the name of each category id
category_name_US <- 
  list(category_id = id, category_name = name) %>%
  as.data.frame()

# Step 2: Join the US video table with the category name table.
### US videos data
US_data <-
  US_data %>%
  left_join(category_name_US)
```

The following will show the first few rows of the data to demonstrate the data used in further sections.
```{r}
### US videos data
US_data %>%
  head()
```

# Section: Numerical Differences among Youtube Video Categories
In this section, the overall distribution of YouTube video categories are inspected. There are 16 categoriess in the November 2017 - June 2018 data. In order to see whether these categories are different, numerical caracteristics including the overall count, average views, likes and dislikes percentage are explored. In the end, a dendrogram showing category grouping is produced based on distances of these numercal variables among categories. 

### Part 1: Overview of US video categories
First, a plot for video counts in this dataset by category is displayed. 
```{r warning=FALSE}
### Most Popular Categories for US
US_data %>%
  ggplot(aes(x = category_name, fill = category_name)) +
  geom_bar(stat = "count") +
  #xlim(c("Entertainment", "Music", "Howto & Style", "Comedy", "People & Blogs", "News & Politics", "Science & Technology", "Film & Animation", "Sports", "Education"))+ 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
labs(x = "Category", y = "Counts", title = "YouTube Video Categories", subtitle = "Nov 2017 - June 2018")+
  theme(legend.position = "none")
```
The plot above shows the categories on the x-axis and their counts on the y-axis. It is clear that an extremely large proportion of the trending videos are in the "Entertainment" category, following by "Music" and "Howto & Style". Some categories such as "Autos & Viehicles," "Nonprofits & Activism," and "Shows," and "Travels & Events" seem to have very small amount of videos identified as trending data from Nov 2017 to June 2018. The other categories in the top ten list appear to have similar amounts.

### Part 2: Views Received
Number of views is an important identifier for whether the video is popular. To better understand the difference in views received on average, the following visualization is produced.

```{r}
### Summary Statistics of views for categories
SummaryStats <- US_data %>%
  group_by(category_name) %>%
  summarise(m_view = mean(views), se_view = sd(views, na.rm = TRUE)/sqrt(n())) #define means and standard error

### Redefine SummaryStat dataframe to include top and bottom of 95% Confidence interval
SummaryStats <- 
  SummaryStats %>%
  mutate(top = m_view + 2 * se_view,
         bottom = m_view - 2 * se_view)

### Plot the graph
SummaryStats %>%
  ggplot(aes(x = category_name, y = m_view)) +
  geom_bar(stat = "identity", alpha=0.2) +
  geom_errorbar(aes(x = category_name, 
                    ymax = top, 
                    ymin =bottom), width=0.5) +
  theme(axis.text.x = element_text(angle = 30, hjust=1))+
  labs(x = "Category", y = "Mean Views", title = "YouTube Video Categories Views Comparison", subtitle = "Nov 2017 - June 2018")
```
The plot above shows the mean video views received for each category. It's interesting to see that although entertainment is the category that contain the most views, its average views is in the middle range. Also, there is a lot variation for videos in the "Non-profits & Activism" category. The category
that receive the highest views on average is the music category, which make sense because these videos usually are produced by famous singers and tend to be watched over and over again.

### Part 3: Like and dislike ratio
YouTube allow users to rate videos as "like" or "dislike" to show users attitudes toward videos. The following plot shows the percentage of likes and dislikes for each category.
```{r}
US_data %>%
  select(category_name, likes, dislikes)  %>%
  gather(key = attitude, value = count, likes, dislikes) %>%
  ggplot(aes(x = category_name, y = count, fill = attitude))+
  geom_bar(position = "fill", stat = "identity")+
  theme(axis.text.x = element_text(angle = 30, hjust=1))
```
According to the plot, generally, these trending videos tend to receive more likes than dislikes no matter which category they fall in. However, in categories such as "News & Politics" and "Nonprofit & Activism", and "Gaming," videos receive more percent of dislikes ratings. This may due to conflicts of view points for these videos' content.

# Section: Dendrogram for similarities among categories
In order to better understand which of these categories are more similar than others in mean views, likes, and dislikes, a dendrogram is produced.
```{r}
### Create a dataframe for Machine learning
ML_Data <- 
  US_data %>%
  select(category_name, views, likes, comment_count, dislikes) %>%
  group_by(category_name) %>%
  summarise(m_views = mean(views), m_likes = mean(likes), m_dislike = mean(dislikes))

### Define row names
rowname <- ML_Data$category_name

### select variables of interest
ML_Data <- 
  ML_Data %>%
  select(m_views, m_likes, m_dislike)

### calculate distance  
cate_diff <- dist(ML_Data)

### Machine learning step
hc <- hclust(cate_diff)
plot(hc, hang =-1, labels=rowname)
```
According to the dendrogram, "Music" appears to be a lot different from other categories. This make sense because as the previous plots shows, music videos have a lot more views on average. It is interesting that "Education" videos seem to be most similar to "News & Politics" and "Comedy" seems to be most similar to "Science & Technology" videos.

# Section: Popular "Title Phrase" among Categories

Titles usually is a brief summary of the content of videos. For the following analysis, the main purpose is to explore the most commonly used words in titles among trending YouTube videos. More importantly, how does the use of vocabulary differ among categories.


### Step 1: Word Count Function

In order to count the word-use frequency, the following function is constructed below to help with separating the title into vocabularies, removing punctuations, and count the amount of word altogether.

```{r}
word_count <- function(variable){
  variable <- gsub('[[:punct:] ]+',' ',variable) ### remove punctuation
  list <- c() ### empty vector
  num <- c() ### empty vector
  for (i in 1:length(variable)){
    string <- variable[i]
    #print(string)
    words <- tolower(unlist(strsplit(string, " "))) ###split the title string
    #print(words)
    for (j in 1:length(words)){
      #print(j)
      position <- match(words[j], list) ###define the position of the vocab in list
      list_length <- length(list) ###calculate the length of list
      num_len <- length(num) ### calculate the length of number
      if (is.na(position) == FALSE){ ### if item in the list
        num[position] <- num[position]+1 ### add a count to the vocab
      }
      else{ ### ekse if vocab not in the list
        list[list_length+1] = words[j] ###create a new row in list
        num[num_len+1] = 1 ### setnumber of elements to 1 for that vocab
      }
    }
  }
  df <- data.frame(list = list, num = num) ### create a dataframe that combine the list of vocab and their count
  return(df)
}
```


### Step 2: Glimpse at overall word usage for titles

In this step, the most widely used words are displayed using the wordcloud graph.

```{r}
### Prepare data 
Title <- US_data %>%
  select(title)
Title <- as.vector(Title)

### Use wordcount function to report the word usage
Title_overall <- word_count(Title)

### Use wordcloud plot to display the distribution of commonly used words
wordcloud(words = Title_overall$list, freq = Title_overall$num, max.words = 200, colors=brewer.pal(8, "Dark2"))
```
In the plot above, the size and color of the words correspond to their popularity. As the figure shows, most of these popular words are prepositions and nouns that do not have much meaning. For example, "the," "a," video, and "official" cannot tell much information about the titles. Hence, a list of stop words that do not have much meaning are created and help cleaning the list of words.

### Step 3: Clean up the key words list using stop words
```{r}
### List of STOP words (popular preposition and pronouns that have no actual meaning)
prep_n_pron <- "^(the|a|s|at|to|of|with|in|on|and|i|you|for|is|am|are|my|it|ft|from|your|this|the|up|by|his|off|official|video|2|day|year|we|me|t|how|what|first|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z|she|her|him|they|them|an|do|don|our|that|he|if|or|make|can|people|should|could|does|so|being|be|about|when|get|have|these|making|not|which|much|etc|every|things|let|just|as|new|vs|out|why|all|were|no)$"
number <- "(0|1|2|3|4|5|6|7|8|9)"
Title_nostop <- Title_overall %>%
  filter(!grepl(prep_n_pron, list), !grepl(number, list))

wordcloud(words = Title_nostop$list, freq = Title_nostop$num, max.words = 200, colors=brewer.pal(8, "Dark2"))
```

After removing the nouns and prepositions that are meaningless, the cloud map now provides more information. "Trailer" appears to be the most popular key word, following by "audio," "challenge", "makeup", and more.


### Step 4: Define the Top 10 Categories
Because of computation complexity, only the key words for the top 10 categories in number of videos are displayed. In the following step, a dataframe is defined for each of these categories and the word count function is applied on them.
```{r}
### Use filter function to define dataframe for each of the top 10 categories
Entertainment <- US_data %>%
  filter(category_name == "Entertainment")

Music <- US_data %>%
  filter(category_name == "Music")

HowtoStyle <- US_data %>%
  filter(category_name == "Howto & Style")

Comedy <- US_data %>%
  filter(category_name == "Comedy")

PeopleBlogs <- US_data %>%
  filter(category_name == "People & Blogs")

NewsPolitics <- US_data %>%
  filter(category_name == "News & Politics")

ScienceTechnology <- US_data %>%
  filter(category_name == "Science & Technology")

FilmAnimation <- US_data %>%
  filter(category_name == "Film & Animation")

Sports <- US_data %>%
  filter(category_name == "Sports")

Education <- US_data %>%
  filter(category_name == "Education")

### Convert the titles into vectors and then apply the word functions to these categories
Entertainment_title <- as.vector(Entertainment$title)
Entertainment_vocab <- word_count(Entertainment_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "Entertainment")

Music_title <- as.vector(Music$title)
Music_vocab <- word_count(Music_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "Music")

HowtoStyle_title <- as.vector(HowtoStyle$title)
HowtoStyle_vocab <- word_count(HowtoStyle_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "HowtoStyle")

Comedy_title <- as.vector(Comedy$title)
Comedy_vocab <- word_count(Comedy_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "Comedy")

PeopleBlogs_title <- as.vector(PeopleBlogs$title)
PeopleBlogs_vocab <- word_count(PeopleBlogs_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "PeopleBlogs")

NewsPolitics_title <- as.vector(NewsPolitics$title)
NewsPolitics_vocab <- word_count(NewsPolitics_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "NewsPolitics")

ScienceTechnology_title <- as.vector(ScienceTechnology$title)
ScienceTechnology_vocab <- word_count(ScienceTechnology_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "ScienceTechnology")

FilmAnimation_title <- as.vector(FilmAnimation$title)
FilmAnimation_vocab <- word_count(FilmAnimation_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "FilmAnimation")

Sports_title <- as.vector(Sports$title)
Sports_vocab <- word_count(Sports_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "Sports")

Education_title <- as.vector(Education$title)
Education_vocab <- word_count(Education_title) %>%
  arrange(desc(num)) %>%
  mutate(category_name = "Education")
```

In order to combine the results for these categories, they are combined into one dataset.
```{r}
### Define a vocabulary count dataset that includes information for all of top 10 categories
Cate_Vocab_Count <-
  rbind(Entertainment_vocab, Music_vocab, HowtoStyle_vocab, Comedy_vocab, PeopleBlogs_vocab, NewsPolitics_vocab, ScienceTechnology_vocab, FilmAnimation_vocab, Sports_vocab, Education_vocab)
```

Then, as we did for the previous plot, some meaningless words are removed from this dataset to provide better insights.
```{r}
Cate_Vocab_Count <- 
  Cate_Vocab_Count %>% 
  filter(!grepl(prep_n_pron, list), !grepl(number, list), list != "") %>% ### use filter function to get rid of meaningless words and blanks
  group_by(category_name) %>%
  mutate(ratio = num / max(num)) %>%
  filter(ratio >= 0.25)
Cate_Vocab_Count
```


Next, a plot showing how top 5 popular vocabularies of each month change from November 2018 to June 2019 is plotted.

```{r}
### remove these from the list of popular words
Cate_Vocab_Count %>%
  na.omit() %>%
  group_by(category_name) %>%
  top_n(5, num) %>%
  ggplot(aes(x = category_name, y = num))+
  geom_point(aes(color = list), size = 2, alpha = 0.5)+
  geom_text_repel(aes(label=list, color = list), angle = 0, alpha = 0.7, nudge_y =1, size = 4) +
  xlim(c("Entertainment", "Music", "HowtoStyle", "Comedy", "PeopleBlogs", "NewsPolitics", "ScienceTechnology", "FilmAnimation", "Sports", "Education"))+
  ylab("Count")+ 
  labs(x = "Category", title = "Most Popular Keywords by Category of Trending YouTube Videos", subtitle = "Nov 2017 - June 2018") +
  theme(legend.position = "none", axis.text.x = element_text(angle = 15))
```
According to the plot above, the most often used words for each category appear to representitive for each video category. For example, in the "Howto & Style" category, videos titles usually contain makeup, cate, beauty, face, and tutorial. This make sense because these videos most likely are about makeup tutorials or teach people how to make cake. It is interesting to see that for some categories such as "Entertainment" and "Film & Animation," the key words appear to be overlapping. Words such as trailer and hd are common in both categories. 

# Conclusion
The 16 trending video categories from Nov 2017 to June 2018 appear to be different in views, ratio of liking, and key words in titles. These differences are consistent with the characteristics of videos in these sixteen categories. Keywords in titles, among other variables, provide the most meaningful explainations. By comparing the key words with the commonly used words in the categories can efficiently help users narrowing down to the most suitable category. Further exploration on how to use key words in titles to categories YouTube videos can be conducted in future analysis.